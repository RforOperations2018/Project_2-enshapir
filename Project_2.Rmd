---
title: "Project 2"
runtime: shiny
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(shiny)
library(flexdashboard)
library(tidyverse)
library(jsonlite)
library(plotly)
library(DT)
library(shinythemes)
library(httr)
library(htmltools)
library(sf)
library(rgdal)
library(leaflet)
library(leaflet.extras)


# #to install pacakgs while working on school computers
# install.packages(c("shiny", "flexdashboard", "tidyverse", "jsonlite", "plotly", "DT", "shinythemes", "httr", "htmltools", "sf", "rgdal", "leaflet", "leaflet.extras"), dependencies = TRUE)



```

```{r}
#API Documentation: https://dev.socrata.com/foundry/data.cityofnewyork.us/qiz3-axqb

#Defining API functions from class
ckanSQL <- function(url) {
  # Make the Request
  r <- RETRY("GET", URLencode(url))
  # Extract Content
  c <- content(r, "text")
  # Basic gsub to make NA's consistent with R
  json <- gsub('NaN', 'NA', c, perl = TRUE)
  # Create Dataframe
  readOGR(json)
}

# Unique values for Resource Field
ckanUniques <- function(id, field) {
  url <- paste0("https://data.wprdc.org/api/action/datastore_search_sql?sql=SELECT%20DISTINCT(%22", field, "%22)%20from%20%22", id, "%22")
  c(ckanSQL(URLencode(url)))
}

url <- "https://data.cityofnewyork.us/resource/qiz3-axqb.geojson"
accidents.load <- ckanSQL(url = url)



  
  



```

Sidebar {.sidebar}
=====================================

```{r}
 CrashInput <- reactive({
    # Race Filter
    if (length(input$SelectedRace) > 0 ) {
      RaceAgeGender.server <- subset(RaceAgeGender, Race %in% input$SelectedRace)
    }
    
    return( RaceAgeGender.server)
  })

selectInput("worldSelect",
               "Homeworld:",
               choices = sort(unique(starwars.load$homeworld)),
               multiple = TRUE,
               selectize = TRUE,
               selected = c("Naboo", "Tatooine"))
   # Birth Selection
   sliderInput("birthSelect",
               "Birth Year:",
               min = min(starwars.load$birth_year, na.rm = T),
               max = max(starwars.load$birth_year, na.rm = T),
               value = c(min(starwars.load$birth_year, na.rm = T), max(starwars.load$birth_year, na.rm = T)),
               step = 1)
```


```{r}
 swInput <- reactive({
    # Race Filter
    if (length(input$SelectedRace) > 0 ) {
      RaceAgeGender.server <- subset(RaceAgeGender, Race %in% input$SelectedRace)
    }
    
    return( RaceAgeGender.server)
  })
```

Column {data-width=650}
-----------------------------------------------------------------------

### Chart A

```{r}


addHeatmap(lng = ~X, lat = ~Y, radius = 8)


```

Column {data-width=350}
-----------------------------------------------------------------------

### Chart B

```{r}
value box, nunber of poeple killed to date
crashes aggregated by hour


```

### Chart C

```{r}
leaflet()%>% 
  setView(-74.4493175, 29.356908, zoom = 4) %>% #set the view of the map
  addCircles(data = test1, lng = ~as.numeric(as.character(longitude)), lat = ~as.numeric(as.character(latitude)), weight = 1, color ='#da0feb')#added the circles over large

 
```

